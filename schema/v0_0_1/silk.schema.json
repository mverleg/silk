{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "https://silk.markv.nl/v0.0.1.json",
  "title": "Silk",
  "description": "Cross-database relational database schema format",
  "type": "object",
  "properties": {
    "silk_version": {
      "description": "The semantic version of Silk that this data schema is exported in",
      "type": "string",
      "minLength": 5,
      "maxLength": 14,
      "pattern": "^(?:0|[1-9]\\d*)\\.(?:0|[1-9]\\d*)\\.(?:0|[1-9]\\d*)$"
    },
    "db": { "$ref":  "#/definitions/db" },
    "table": { "$ref":  "#/definitions/table" }
  },
  "additionalProperties": true,
  "definitions": {
    "identifier": {
      "type": "string",
      "description": "A name of a table, column or similar in the database",
      "examples": ["Shopping_Cart", "customer_id"],
      "min_length": 1,
      "max_length": 512,
      "pattern": "^[a-zA-Z][a-zA-Z0-9_]*$"
    },
    "database_specific": {
      "type": "object",
      "description": "Properties for the specific database, not controlled by Silk",
      "additionalProperties": true
    },
    "db": {
      "name":  "A full database with multiple tables.",
      "properties": {
        "name": { "$ref": "#/definitions/identifier" },
        "description": { "type": "string" },
        "tables": {
          "description": "The tables in the database",
          "type": "array",
          "items": { "$ref": "#/definitions/table" }
        },
        "database_type": { "$ref": "#/definitions/identifier" },
        "database_specific": { "$ref": "#/definitions/database_specific" }
      },
      "additionalProperties": false
    },
    "table": {
      "name": "A single database table",
      "properties": {
        "name": { "$ref": "#/definitions/identifier" },
        "group": { "$ref": "#/definitions/identifier" },
        "description": { "type": "string" },
        "columns": {
          "type": "array",
          "items": { "$ref": "#/definitions/column" }
        },
        "primary_key": {
          "type": "array",
          "items": { "$ref": "#/definitions/identifier" }
        },
        "references": {
          "type": "array",
          "items": { "$ref": "#/definitions/foreign_key" }
        },
        "unique_constraints": {
          "type": "array",
          "items": { "$ref": "#/definitions/unique_constraint" }
        },
        "check_constraints": {
          "type": "array",
          "items": { "$ref": "#/definitions/check_constraint" }
        },
        "database_specific": { "$ref": "#/definitions/database_specific" }
      },
      "additionalProperties": false
    },
    "column": {
      "type": "object",
      "properties": {
        "name": { "$ref": "#/definitions/identifier" },
        "type": { "$ref": "#/definitions/data_types" },
        "nullable": {
          "type": "boolean",
          "description": "Can the value be null"
        },
        "auto_value": { "$ref": "#/definitions/auto_options" }
      },
      "additionalProperties": false
    },
    "foreign_key": {
      "type": "object",
      "additionalProperties": false
    },
    "unique_constraint": {
      "type": "object",
      "additionalProperties": false
    },
    "check_constraint": {
      "type": "object",
      "additionalProperties": false
    }
  },
  "oneOf": [
      { "required": ["silk_version", "db"] },
      { "required": ["silk_version", "table"] }
  ]
}
